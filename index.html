<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GRI RSS</title>
    <script src="script.js"></script>
  </head>
  <body>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script>
      (async () => {
        /* fetch JSON data and parse */
        const url = 'https://sheetjs.com/data/executive.json';
        const raw_data = await (await fetch(url)).json();

        /* filter for the Presidents */
        const prez = raw_data.filter((row) =>
          row.terms.some((term) => term.type === 'prez')
        );

        /* sort by first presidential term */
        prez.forEach(
          (row) =>
            (row.start = row.terms.find((term) => term.type === 'prez').start)
        );
        prez.sort((l, r) => l.start.localeCompare(r.start));

        /* flatten objects */
        const rows = prez.map((row) => ({
          name: row.name.first + ' ' + row.name.last,
          birthday: row.bio.birthday,
        }));

        /* generate worksheet and workbook */
        const worksheet = XLSX.utils.json_to_sheet(rows);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, 'Dates');

        /* fix headers */
        XLSX.utils.sheet_add_aoa(worksheet, [['Name', 'Birthday']], {
          origin: 'A1',
        });

        /* calculate column width */
        const max_width = rows.reduce((w, r) => Math.max(w, r.name.length), 10);
        worksheet['!cols'] = [{ wch: max_width }];

        /* create an XLSX file and try to save to Presidents.xlsx */
        XLSX.writeFile(workbook, 'Presidents.xlsx', { compression: true });
      })();
    </script>
  </body>
</html>
